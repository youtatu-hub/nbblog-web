(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2968d3be"],{"05c6":function(e,t,o){},4020:function(e,t,o){"use strict";var r=o("bc3a"),n=o.n(r),i=o("323e"),a=o.n(i),s=(o("a5d8"),o("5c96"));const l=n.a.create({baseURL:"/api/admin/",timeout:5e3});let c=n.a.CancelToken;l.interceptors.request.use(e=>{const t=window.localStorage.getItem("user")||"{}",o=JSON.parse(t);if("{}"!==t&&"ROLE_admin"!==o.role&&"get"!==e.method)return e.cancelToken=new c((function(e){e("演示模式，不允许操作")})),e;a.a.start();const r=window.localStorage.getItem("token");return r&&(e.headers.Authorization=r),e},e=>(console.info(e),Promise.reject(e))),l.interceptors.response.use(e=>{a.a.done();const t=e.data;if(200!==t.code){let e=t.msg||"Error";return s["Message"].error(e),Promise.reject(new Error(e))}return t},e=>(console.info(e),s["Message"].error(e.message),Promise.reject(e))),t["a"]=l},"864d":function(e,t,o){"use strict";o.d(t,"d",(function(){return n})),o.d(t,"a",(function(){return i})),o.d(t,"c",(function(){return a})),o.d(t,"e",(function(){return s})),o.d(t,"h",(function(){return l})),o.d(t,"g",(function(){return c})),o.d(t,"i",(function(){return d})),o.d(t,"b",(function(){return u})),o.d(t,"f",(function(){return m}));var r=o("4020");function n(e){return Object(r["a"])({url:"blogs",method:"GET",params:{...e}})}function i(e){return Object(r["a"])({url:"blog",method:"DELETE",params:{id:e}})}function a(){return Object(r["a"])({url:"categoryAndTag",method:"GET"})}function s(e){return Object(r["a"])({url:"blog",method:"POST",data:{...e}})}function l(e,t){return Object(r["a"])({url:"blog/top",method:"PUT",params:{id:e,top:t}})}function c(e,t){return Object(r["a"])({url:"blog/recommend",method:"PUT",params:{id:e,recommend:t}})}function d(e,t){return Object(r["a"])({url:`blog/${e}/visibility`,method:"PUT",data:{...t}})}function u(e){return Object(r["a"])({url:"blog",method:"GET",params:{id:e}})}function m(e){return Object(r["a"])({url:"blog",method:"PUT",data:{...e}})}},a215:function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-row",[o("el-col",{attrs:{span:8}},[o("el-input",{staticStyle:{"min-width":"500px"},attrs:{placeholder:"请输入标题",clearable:!0,size:"small"},on:{clear:e.search},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.queryInfo.title,callback:function(t){e.$set(e.queryInfo,"title",t)},expression:"queryInfo.title"}},[o("el-select",{staticStyle:{width:"160px"},attrs:{slot:"prepend",placeholder:"请选择分类",clearable:!0},on:{change:e.search},slot:"prepend",model:{value:e.queryInfo.categoryId,callback:function(t){e.$set(e.queryInfo,"categoryId",t)},expression:"queryInfo.categoryId"}},e._l(e.categoryList,(function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),o("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.search},slot:"append"})],1)],1)],1),o("el-table",{attrs:{data:e.blogList}},[o("el-table-column",{attrs:{label:"序号",type:"index",width:"50"}}),o("el-table-column",{attrs:{label:"标题",prop:"title","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"分类",prop:"category.name",width:"150"}}),o("el-table-column",{attrs:{label:"置顶",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-switch",{on:{change:function(o){return e.blogTopChanged(t.row)}},model:{value:t.row.top,callback:function(o){e.$set(t.row,"top",o)},expression:"scope.row.top"}})]}}])}),o("el-table-column",{attrs:{label:"推荐",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-switch",{on:{change:function(o){return e.blogRecommendChanged(t.row)}},model:{value:t.row.recommend,callback:function(o){e.$set(t.row,"recommend",o)},expression:"scope.row.recommend"}})]}}])}),o("el-table-column",{attrs:{label:"可见性",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-link",{attrs:{icon:"el-icon-edit",underline:!1},on:{click:function(o){return e.editBlogVisibility(t.row)}}},[e._v(" "+e._s(t.row.published?""!==t.row.password?"密码保护":"公开":"私密")+" ")])]}}])}),o("el-table-column",{attrs:{label:"创建时间",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("dateFormat")(t.row.createTime)))]}}])}),o("el-table-column",{attrs:{label:"最近更新",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("dateFormat")(t.row.updateTime)))]}}])}),o("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(o){return e.goBlogEditPage(t.row.id)}}},[e._v("编辑")]),o("el-popconfirm",{attrs:{title:"确定删除吗？",icon:"el-icon-delete",iconColor:"red"},on:{onConfirm:function(o){return e.deleteBlogById(t.row.id)}}},[o("el-button",{attrs:{slot:"reference",size:"mini",type:"danger",icon:"el-icon-delete"},slot:"reference"},[e._v("删除")])],1)]}}])})],1),o("el-pagination",{attrs:{"current-page":e.queryInfo.pageNum,"page-sizes":[10,20,30,50],"page-size":e.queryInfo.pageSize,total:e.total,layout:"total, sizes, prev, pager, next, jumper",background:""},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),o("el-dialog",{attrs:{title:"博客可见性",width:"30%",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[o("el-form",{attrs:{"label-width":"50px"},nativeOn:{submit:function(e){e.preventDefault()}}},[o("el-form-item",[o("el-radio-group",{model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[o("el-radio",{attrs:{label:1}},[e._v("公开")]),o("el-radio",{attrs:{label:2}},[e._v("私密")]),o("el-radio",{attrs:{label:3}},[e._v("密码保护")])],1)],1),3===e.radio?o("el-form-item",{attrs:{label:"密码"}},[o("el-input",{model:{value:e.visForm.password,callback:function(t){e.$set(e.visForm,"password",t)},expression:"visForm.password"}})],1):e._e(),2!==e.radio?o("el-form-item",[o("el-row",[o("el-col",{attrs:{span:6}},[o("el-switch",{attrs:{"active-text":"赞赏"},model:{value:e.visForm.appreciation,callback:function(t){e.$set(e.visForm,"appreciation",t)},expression:"visForm.appreciation"}})],1),o("el-col",{attrs:{span:6}},[o("el-switch",{attrs:{"active-text":"推荐"},model:{value:e.visForm.recommend,callback:function(t){e.$set(e.visForm,"recommend",t)},expression:"visForm.recommend"}})],1),o("el-col",{attrs:{span:6}},[o("el-switch",{attrs:{"active-text":"评论"},model:{value:e.visForm.commentEnabled,callback:function(t){e.$set(e.visForm,"commentEnabled",t)},expression:"visForm.commentEnabled"}})],1),o("el-col",{attrs:{span:6}},[o("el-switch",{attrs:{"active-text":"置顶"},model:{value:e.visForm.top,callback:function(t){e.$set(e.visForm,"top",t)},expression:"visForm.top"}})],1)],1)],1):e._e()],1),o("span",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:e.saveVisibility}},[e._v("保存")])],1)],1)],1)},n=[],i=o("6350"),a=o("864d"),s={name:"BlogList",components:{Breadcrumb:i["a"]},data(){return{queryInfo:{title:"",categoryId:null,pageNum:1,pageSize:10},blogList:[],categoryList:[],total:0,dialogVisible:!1,blogId:0,radio:1,visForm:{appreciation:!1,recommend:!1,commentEnabled:!1,top:!1,published:!1,password:""}}},created(){this.getData()},methods:{getData(){Object(a["d"])(this.queryInfo).then(e=>{this.blogList=e.data.blogs.list,this.categoryList=e.data.categories,this.total=e.data.blogs.total})},search(){this.queryInfo.pageNum=1,this.queryInfo.pageSize=10,this.getData()},blogTopChanged(e){Object(a["h"])(e.id,e.top).then(e=>{this.msgSuccess(e.msg)})},blogRecommendChanged(e){Object(a["g"])(e.id,e.recommend).then(e=>{this.msgSuccess(e.msg)})},editBlogVisibility(e){this.visForm={appreciation:e.appreciation,recommend:e.recommend,commentEnabled:e.commentEnabled,top:e.top,published:e.published,password:e.password},this.blogId=e.id,this.radio=this.visForm.published?""!==this.visForm.password?3:1:2,this.dialogVisible=!0},saveVisibility(){if(3===this.radio&&(""===this.visForm.password||null===this.visForm.password))return this.msgError("密码保护模式必须填写密码！");2===this.radio?(this.visForm.appreciation=!1,this.visForm.recommend=!1,this.visForm.commentEnabled=!1,this.visForm.top=!1,this.visForm.published=!1):this.visForm.published=!0,3!==this.radio&&(this.visForm.password=""),Object(a["i"])(this.blogId,this.visForm).then(e=>{this.msgSuccess(e.msg),this.getData(),this.dialogVisible=!1})},handleSizeChange(e){this.queryInfo.pageSize=e,this.getData()},handleCurrentChange(e){this.queryInfo.pageNum=e,this.getData()},goBlogEditPage(e){this.$router.push("/blog/edit/"+e)},deleteBlogById(e){this.$confirm('此操作将永久删除该博客<strong style="color: red">及其所有评论</strong>，是否删除?<br>建议将博客置为<strong style="color: red">私密</strong>状态！',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then(()=>{Object(a["a"])(e).then(e=>{this.msgSuccess(e.msg),this.getData()})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})}}},l=s,c=(o("d5f4"),o("2877")),d=Object(c["a"])(l,r,n,!1,null,"40a85889",null);t["default"]=d.exports},d5f4:function(e,t,o){"use strict";o("05c6")}}]);