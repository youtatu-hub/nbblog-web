(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-55b4161b"],{"00ee":function(t,e,n){var i=n("b622"),a=i("toStringTag"),o={};o[a]="z",t.exports="[object z]"===String(o)},"0366":function(t,e,n){var i=n("1c0b");t.exports=function(t,e,n){if(i(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,a){return t.call(e,n,i,a)}}return function(){return t.apply(e,arguments)}}},"05a7":function(t,e,n){},2266:function(t,e,n){var i=n("825a"),a=n("e95a"),o=n("50c4"),s=n("0366"),r=n("35a1"),c=n("9bdd"),l=function(t,e){this.stopped=t,this.result=e},u=t.exports=function(t,e,n,u,p){var h,f,m,d,g,y,v,b=s(e,n,u?2:1);if(p)h=t;else{if(f=r(t),"function"!=typeof f)throw TypeError("Target is not iterable");if(a(f)){for(m=0,d=o(t.length);d>m;m++)if(g=u?b(i(v=t[m])[0],v[1]):b(t[m]),g&&g instanceof l)return g;return new l(!1)}h=f.call(t)}y=h.next;while(!(v=y.call(h)).done)if(g=c(h,b,v.value,u),"object"==typeof g&&g&&g instanceof l)return g;return new l(!1)};u.stop=function(t){return new l(!0,t)}},"35a1":function(t,e,n){var i=n("f5dfe"),a=n("3f8c"),o=n("b622"),s=o("iterator");t.exports=function(t){if(void 0!=t)return t[s]||t["@@iterator"]||a[i(t)]}},"3ae7":function(t,e,n){"use strict";n("05a7")},"3f8c":function(t,e){t.exports={}},"4e3e":function(t,e,n){"use strict";var i=n("23e7"),a=n("2266"),o=n("825a");i({target:"Iterator",proto:!0,real:!0},{forEach:function(t){a(o(this),t,void 0,!1,!0)}})},"64c0":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-row",[n("el-select",{staticStyle:{"min-width":"200px"},attrs:{disabled:""},model:{value:t.upyunConfig.bucketName,callback:function(e){t.$set(t.upyunConfig,"bucketName",e)},expression:"upyunConfig.bucketName"}}),n("el-cascader",{staticStyle:{"min-width":"450px"},attrs:{placeholder:"请选择目录",options:t.pathArr,props:t.pathProps},model:{value:t.activePath,callback:function(e){t.activePath=e},expression:"activePath"}}),n("el-button",{attrs:{type:"primary",size:"medium",icon:"el-icon-search"},on:{click:t.search}},[t._v("查询")]),n("el-button",{staticClass:"right-item",attrs:{type:"primary",size:"medium",icon:"el-icon-upload"},on:{click:function(e){t.isDrawerShow=!t.isDrawerShow}}},[t._v("上传")])],1),t.hintShow1?n("el-alert",{attrs:{title:"只显示<img>标签支持的 apng,avif,bmp,gif,ico,cur,jpg,jpeg,jfif,pjpeg,pjp,png,svg,tif,tiff,webp 格式的图片，见 https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/img",type:"warning","show-icon":"","close-text":"不再提示"},on:{close:function(e){return t.noDisplay(1)}}}):t._e(),t.hintShow2?n("el-alert",{attrs:{title:"最多显示100个文件",type:"warning","show-icon":"","close-text":"不再提示"},on:{close:function(e){return t.noDisplay(2)}}}):t._e(),n("el-row",{directives:[{name:"viewer",rawName:"v-viewer"}]},t._l(t.fileList,(function(e,i){return n("div",{key:i,staticClass:"image-container"},[n("el-image",{attrs:{src:e.cdn_url,fit:"scale-down"}}),n("div",{staticClass:"image-content"},[n("div",{staticClass:"info"},[n("span",[t._v(t._s(e.name))])]),n("div",{staticClass:"icons"},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"复制CDN链接",placement:"bottom"}},[n("i",{staticClass:"icon el-icon-link",on:{click:function(n){return t.copy(1,e)}}})]),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"复制MD格式",placement:"bottom"}},[n("SvgIcon",{attrs:{"icon-class":"markdown","class-name":"icon"},on:{click:function(n){return t.copy(2,e)}}})],1),n("i",{staticClass:"icon el-icon-delete",on:{click:function(n){return t.delFile(e)}}})],1)])],1)})),0),n("el-drawer",{attrs:{title:"上传文件",visible:t.isDrawerShow,direction:"rtl",size:"40%",wrapperClosable:!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.isDrawerShow=e}}},[n("el-row",[n("el-radio",{attrs:{label:"1"},model:{value:t.nameType,callback:function(e){t.nameType=e},expression:"nameType"}},[t._v("使用源文件名")]),n("el-radio",{attrs:{label:"2"},model:{value:t.nameType,callback:function(e){t.nameType=e},expression:"nameType"}},[t._v("使用UUID文件名")]),n("el-button",{directives:[{name:"throttle",rawName:"v-throttle",value:[t.submitUpload,"click",3e3],expression:"[submitUpload,`click`,3000]"}],attrs:{size:"small",type:"primary",icon:"el-icon-upload"}},[t._v("确定上传")])],1),n("el-row",[t._v(" 当前目录："+t._s(t.realPath)+" ")]),n("el-row",[n("el-switch",{attrs:{"active-text":"自定义目录"},model:{value:t.isCustomPath,callback:function(e){t.isCustomPath=e},expression:"isCustomPath"}}),n("el-input",{staticStyle:{"margin-top":"10px"},attrs:{placeholder:"例：oldFolder/newFolder/",disabled:!t.isCustomPath,size:"medium"},model:{value:t.customPath,callback:function(e){t.customPath=e},expression:"customPath"}})],1),n("el-upload",{ref:"uploadRef",attrs:{action:"","http-request":t.upload,drag:"",multiple:"","file-list":t.uploadList,"list-type":"picture","auto-upload":!1}},[n("i",{staticClass:"el-icon-upload"}),n("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),n("em",[t._v("点击上传")])])])],1)],1)},a=[],o=(n("0643"),n("4e3e"),n("c00a")),s=n("bc3a"),r=n.n(s),c=n("323e"),l=n.n(c),u=(n("a5d8"),n("5c96"));const p=r.a.create({baseURL:"https://v0.api.upyun.com",timeout:3e4});function h(t,e){return e=e.startsWith("/")?e:"/"+e,p({url:`/${t}${e}`,method:"GET"})}function f(t,e){return p({url:`/${t}${e}`,method:"DELETE"})}function m(t,e,n,i){return e=e.startsWith("/")?e:"/"+e,e=e.endsWith("/")?e:e+"/",p({url:`/${t}${e}${n}`,method:"PUT",data:i})}p.interceptors.request.use(t=>{l.a.start(),t.headers["Accept"]="application/json";const e=localStorage.getItem("upyunToken");return e&&(t.headers["Authorization"]="Basic "+e),t},t=>(console.info(t),Promise.reject(t))),p.interceptors.response.use(t=>(l.a.done(),t.data),t=>(console.info(t),u["Message"].error(t.message),Promise.reject(t)));var d=n("c54a"),g=n("f988"),y=n("f43e"),v={name:"UpyunManage",components:{SvgIcon:o["a"]},data(){return{upyunConfig:{username:"",password:"",bucketName:"",domain:""},pathArr:[{value:"",label:"根目录"}],activePath:[""],pathProps:{lazy:!0,checkStrictly:!0,lazyLoad:async(t,e)=>{let n=t.path.join("/"),i=[];await this.getReposContents(i,n),e(i)}},hintShow1:!0,hintShow2:!0,fileList:[],isDrawerShow:!1,nameType:"1",uploadList:[],isCustomPath:!1,customPath:""}},computed:{realPath(){return this.isCustomPath?"/"+this.customPath:this.activePath.join("/")+"/"}},created(){this.hintShow1=!localStorage.getItem("upyunHintShow1"),this.hintShow2=!localStorage.getItem("upyunHintShow2");const t=localStorage.getItem("upyunConfig");t?this.upyunConfig=JSON.parse(t):(this.msgError("请先配置又拍云"),this.$router.push("/pictureHosting/setting"))},methods:{async getReposContents(t,e){await h(this.upyunConfig.bucketName,e).then(e=>{e.files.forEach(e=>{"folder"===e.type&&t.push({value:e.name,label:e.name,leaf:!1})})})},search(){this.fileList=[];let t=this.activePath.join("/");h(this.upyunConfig.bucketName,t).then(t=>{t.files.forEach(t=>{"folder"!==t.type&&Object(d["b"])(t.name)&&(t.path=this.imgPath(t),t.cdn_url=this.imgCdnUrl(t),this.fileList.push(t))})})},noDisplay(t){localStorage.setItem("upyunHintShow"+t,"1")},imgPath(t){let e=this.activePath.join("/");return e=e.startsWith("/")?e:"/"+e,e=e.endsWith("/")?e:e+"/",`${e}${t.name}`},imgCdnUrl(t){return`${this.upyunConfig.domain}${this.imgPath(t)}`},copy(t,e){let n="";1==t?n=e.cdn_url:2==t&&(n=`![${e.name}](${e.cdn_url})`),Object(y["a"])(n),this.msgSuccess("复制成功")},delFile(t){this.$confirm("此操作将永久删除该文件, 是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{f(this.upyunConfig.bucketName,t.path).then(()=>{this.msgSuccess("删除成功"),this.search()})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},submitUpload(){this.uploadList=this.$refs.uploadRef.uploadFiles,this.uploadList.length?this.$refs.uploadRef.submit():this.msgError("请先选择文件")},upload(t){let e=t.file.name;"2"===this.nameType&&(e=Object(g["a"])()+e.substr(e.lastIndexOf("."))),m(this.upyunConfig.bucketName,this.realPath,e,t.file).then(()=>{this.msgSuccess("上传成功"),t.onSuccess()})}}},b=v,x=(n("3ae7"),n("991b"),n("2877")),w=Object(x["a"])(b,i,a,!1,null,"9a1f671a",null);e["default"]=w.exports},"991b":function(t,e,n){"use strict";n("dc7e")},dc7e:function(t,e,n){},e95a:function(t,e,n){var i=n("b622"),a=n("3f8c"),o=i("iterator"),s=Array.prototype;t.exports=function(t){return void 0!==t&&(a.Array===t||s[o]===t)}},f43e:function(t,e,n){"use strict";function i(t){let e=document.createElement("input");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("Copy"),e.remove()}n.d(e,"a",(function(){return i}))},f5dfe:function(t,e,n){var i=n("00ee"),a=n("c6b6"),o=n("b622"),s=o("toStringTag"),r="Arguments"==a(function(){return arguments}()),c=function(t,e){try{return t[e]}catch(n){}};t.exports=i?a:function(t){var e,n,i;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=c(e=Object(t),s))?n:r?a(e):"Object"==(i=a(e))&&"function"==typeof e.callee?"Arguments":i}},f988:function(t,e,n){"use strict";function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){let e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)}))}n.d(e,"a",(function(){return i}))}}]);